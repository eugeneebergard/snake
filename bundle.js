/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	// The require scope
/******/ 	var __webpack_require__ = {};
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
__webpack_require__.r(__webpack_exports__);
const canvas = document.getElementById('game');
const context = canvas.getContext('2d');
const scoreCounter = document.getElementById('score__counter');
const modeButton = document.getElementById('mode');
const stateModeButton = document.getElementById('mode__state');
const grid = 16;
let count = 0;
let gameSpeed = 4;
let applesEaten = 0;
let modeWithBorders = false;
const snake = {
    x: 160,
    y: 160,
    dx: grid,
    dy: 0,
    cells: [],
    maxCells: 4
};
const apple = {
    x: 320,
    y: 320
};
function getRandomInt(min, max) {
    return Math.floor(Math.random() * (max - min)) + min;
}
function createApple() {
    apple.x = getRandomInt(0, 25) * grid;
    apple.y = getRandomInt(0, 25) * grid;
}
function restart() {
    snake.x = 160;
    snake.y = 160;
    snake.cells = [];
    snake.maxCells = 4;
    snake.dx = grid;
    snake.dy = 0;
    applesEaten = 0;
    scoreCounter.textContent = applesEaten.toString();
    createApple();
}
function redrawGame(text, addClass, removeClass) {
    stateModeButton.textContent = text;
    canvas.classList.add(addClass);
    canvas.classList.remove(removeClass);
}
function toggleBorders() {
    modeWithBorders = !modeWithBorders;
    modeWithBorders ?
        redrawGame('on', 'borders_on', 'borders_off') :
        redrawGame('off', 'borders_off', 'borders_on');
    restart();
}
function loop() {
    requestAnimationFrame(loop);
    if (++count < gameSpeed)
        return;
    count = 0;
    context.clearRect(0, 0, canvas.width, canvas.height);
    snake.x += snake.dx;
    snake.y += snake.dy;
    if (snake.x < 0)
        modeWithBorders ? restart() : snake.x = canvas.width - grid;
    else if (snake.x >= canvas.width)
        modeWithBorders ? restart() : snake.x = 0;
    if (snake.y < 0)
        modeWithBorders ? restart() : snake.y = canvas.height - grid;
    else if (snake.y >= canvas.height)
        modeWithBorders ? restart() : snake.y = 0;
    snake.cells.unshift({ x: snake.x, y: snake.y });
    snake.cells.length > snake.maxCells && snake.cells.pop();
    context.fillStyle = 'red';
    context.fillRect(apple.x, apple.y, grid - 1, grid - 1);
    context.fillStyle = 'green';
    snake.cells.forEach((cell, index) => {
        context.fillRect(cell.x, cell.y, grid - 1, grid - 1);
        if (cell.x === apple.x && cell.y === apple.y) {
            snake.maxCells++;
            createApple();
            applesEaten++;
            scoreCounter.textContent = applesEaten.toString();
        }
        for (let i = index + 1; i < snake.cells.length; i++) {
            if (cell.x === snake.cells[i].x && cell.y === snake.cells[i].y) {
                restart();
            }
        }
    });
}
document.addEventListener('keydown', (e) => {
    switch (e.which) {
        case 16:
            // Shift
            gameSpeed = 2;
            break;
        case 27:
            // Escape
            restart();
            break;
        case 37:
            // Стрелка влево
            if (snake.dx === 0) {
                snake.dx = -grid;
                snake.dy = 0;
            }
            break;
        case 38:
            // Стрелка вверх
            if (snake.dy === 0) {
                snake.dy = -grid;
                snake.dx = 0;
            }
            break;
        case 39:
            // Стрелка вправо
            if (snake.dx === 0) {
                snake.dx = grid;
                snake.dy = 0;
            }
            break;
        case 40:
            // Стрелка вниз
            if (snake.dy === 0) {
                snake.dy = grid;
                snake.dx = 0;
            }
            break;
    }
});
document.addEventListener('keyup', (e) => {
    if (e.which === 16) {
        gameSpeed = 4;
    }
});
modeButton.addEventListener('click', () => {
    toggleBorders();
});
requestAnimationFrame(loop);


/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQUUsR0FBRyxJQUFJLENBQUM7Z0JBQ2hCLEtBQUssQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO2FBQ2Q7WUFDRCxNQUFNO0tBQ1Q7QUFDSCxDQUFDLENBQUMsQ0FBQztBQUVILFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRTtJQUN2QyxJQUFHLENBQUMsQ0FBQyxLQUFLLEtBQUssRUFBRSxFQUFFO1FBQ2pCLFNBQVMsR0FBRyxDQUFDLENBQUM7S0FDZjtBQUNILENBQUMsQ0FBQyxDQUFDO0FBRUgsVUFBVSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUU7SUFDeEMsYUFBYSxFQUFFLENBQUM7QUFDbEIsQ0FBQyxDQUFDLENBQUM7QUFFSCxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL3NuYWtlL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3NuYWtlL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vc25ha2UvLi9zcmMvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsImltcG9ydCB7IElTbmFrZSwgSUFwcGxlIH0gZnJvbSBcIi4vc25ha2UudHlwZXNcIjtcblxuY29uc3QgY2FudmFzID0gPEhUTUxDYW52YXNFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lJyk7XG5jb25zdCBjb250ZXh0ID0gPENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRD5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbmNvbnN0IHNjb3JlQ291bnRlciA9IDxIVE1MRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NvcmVfX2NvdW50ZXInKTtcbmNvbnN0IG1vZGVCdXR0b24gPSA8SFRNTEJ1dHRvbkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGUnKTtcbmNvbnN0IHN0YXRlTW9kZUJ1dHRvbiA9IDxIVE1MRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kZV9fc3RhdGUnKTtcblxuY29uc3QgZ3JpZDogbnVtYmVyID0gMTY7XG5sZXQgY291bnQ6IG51bWJlciA9IDA7XG5sZXQgZ2FtZVNwZWVkOiBudW1iZXIgPSA0O1xubGV0IGFwcGxlc0VhdGVuOiBudW1iZXIgPSAwO1xubGV0IG1vZGVXaXRoQm9yZGVyczogYm9vbGVhbiA9IGZhbHNlO1xuXG5jb25zdCBzbmFrZTogSVNuYWtlID0ge1xuICB4OiAxNjAsXG4gIHk6IDE2MCxcbiAgZHg6IGdyaWQsXG4gIGR5OiAwLFxuICBjZWxsczogW10sXG4gIG1heENlbGxzOiA0XG59XG5cbmNvbnN0IGFwcGxlOiBJQXBwbGUgPSB7XG4gIHg6IDMyMCxcbiAgeTogMzIwXG59XG5cbmZ1bmN0aW9uIGdldFJhbmRvbUludChtaW46IG51bWJlciwgbWF4OiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbikpICsgbWluO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVBcHBsZSgpOiB2b2lkIHtcbiAgYXBwbGUueCA9IGdldFJhbmRvbUludCgwLCAyNSkgKiBncmlkO1xuICBhcHBsZS55ID0gZ2V0UmFuZG9tSW50KDAsIDI1KSAqIGdyaWQ7XG59XG5cbmZ1bmN0aW9uIHJlc3RhcnQoKTogdm9pZCB7XG4gIHNuYWtlLnggPSAxNjA7XG4gIHNuYWtlLnkgPSAxNjA7XG4gIHNuYWtlLmNlbGxzID0gW107XG4gIHNuYWtlLm1heENlbGxzID0gNDtcbiAgc25ha2UuZHggPSBncmlkO1xuICBzbmFrZS5keSA9IDA7XG5cbiAgYXBwbGVzRWF0ZW4gPSAwO1xuICBzY29yZUNvdW50ZXIudGV4dENvbnRlbnQgPSBhcHBsZXNFYXRlbi50b1N0cmluZygpO1xuXG4gIGNyZWF0ZUFwcGxlKCk7XG59XG5cbmZ1bmN0aW9uIHJlZHJhd0dhbWUodGV4dDogc3RyaW5nLCBhZGRDbGFzczogc3RyaW5nLCByZW1vdmVDbGFzczogc3RyaW5nKTogdm9pZCB7XG4gIHN0YXRlTW9kZUJ1dHRvbi50ZXh0Q29udGVudCA9IHRleHQ7XG4gIGNhbnZhcy5jbGFzc0xpc3QuYWRkKGFkZENsYXNzKTtcbiAgY2FudmFzLmNsYXNzTGlzdC5yZW1vdmUocmVtb3ZlQ2xhc3MpO1xufVxuXG5mdW5jdGlvbiB0b2dnbGVCb3JkZXJzKCkge1xuICBtb2RlV2l0aEJvcmRlcnMgPSAhbW9kZVdpdGhCb3JkZXJzO1xuXG4gIG1vZGVXaXRoQm9yZGVycyA/XG4gICAgcmVkcmF3R2FtZSgnb24nLCAnYm9yZGVyc19vbicsICdib3JkZXJzX29mZicpOlxuICAgIHJlZHJhd0dhbWUoJ29mZicsICdib3JkZXJzX29mZicsICdib3JkZXJzX29uJyk7XG5cbiAgcmVzdGFydCgpO1xufVxuXG5mdW5jdGlvbiBsb29wKCk6IHZvaWQge1xuICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobG9vcCk7XG5cbiAgaWYgKCsrY291bnQgPCBnYW1lU3BlZWQpIHJldHVybjtcblxuICBjb3VudCA9IDA7XG5cbiAgY29udGV4dC5jbGVhclJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcblxuICBzbmFrZS54ICs9IHNuYWtlLmR4O1xuICBzbmFrZS55ICs9IHNuYWtlLmR5O1xuXG4gIGlmIChzbmFrZS54IDwgMCkgbW9kZVdpdGhCb3JkZXJzID8gcmVzdGFydCgpIDogc25ha2UueCA9IGNhbnZhcy53aWR0aCAtIGdyaWQ7XG4gIGVsc2UgaWYgKHNuYWtlLnggPj0gY2FudmFzLndpZHRoKSBtb2RlV2l0aEJvcmRlcnMgPyByZXN0YXJ0KCkgOiBzbmFrZS54ID0gMDtcblxuICBpZiAoc25ha2UueSA8IDApIG1vZGVXaXRoQm9yZGVycyA/IHJlc3RhcnQoKSA6IHNuYWtlLnkgPSBjYW52YXMuaGVpZ2h0IC0gZ3JpZDtcbiAgZWxzZSBpZiAoc25ha2UueSA+PSBjYW52YXMuaGVpZ2h0KSBtb2RlV2l0aEJvcmRlcnMgPyByZXN0YXJ0KCkgOiBzbmFrZS55ID0gMDtcblxuICBzbmFrZS5jZWxscy51bnNoaWZ0KHsgeDogc25ha2UueCwgeTogc25ha2UueSB9KTtcblxuICBzbmFrZS5jZWxscy5sZW5ndGggPiBzbmFrZS5tYXhDZWxscyAmJiBzbmFrZS5jZWxscy5wb3AoKTtcblxuICBjb250ZXh0LmZpbGxTdHlsZSA9ICdyZWQnO1xuICBjb250ZXh0LmZpbGxSZWN0KGFwcGxlLngsIGFwcGxlLnksIGdyaWQgLSAxLCBncmlkIC0gMSk7XG5cbiAgY29udGV4dC5maWxsU3R5bGUgPSAnZ3JlZW4nO1xuXG4gIHNuYWtlLmNlbGxzLmZvckVhY2goKGNlbGwsIGluZGV4KSA9PiB7XG4gICAgY29udGV4dC5maWxsUmVjdChjZWxsLngsIGNlbGwueSwgZ3JpZCAtIDEsIGdyaWQgLSAxKTtcblxuICAgIGlmIChjZWxsLnggPT09IGFwcGxlLnggJiYgY2VsbC55ID09PSBhcHBsZS55KSB7XG4gICAgICBzbmFrZS5tYXhDZWxscysrO1xuXG4gICAgICBjcmVhdGVBcHBsZSgpO1xuXG4gICAgICBhcHBsZXNFYXRlbisrO1xuICAgICAgc2NvcmVDb3VudGVyLnRleHRDb250ZW50ID0gYXBwbGVzRWF0ZW4udG9TdHJpbmcoKTtcbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IGluZGV4ICsgMTsgaSA8IHNuYWtlLmNlbGxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoY2VsbC54ID09PSBzbmFrZS5jZWxsc1tpXS54ICYmIGNlbGwueSA9PT0gc25ha2UuY2VsbHNbaV0ueSkge1xuICAgICAgICByZXN0YXJ0KCk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn1cblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7XG4gIHN3aXRjaCAoZS53aGljaCl7XG4gICAgY2FzZSAxNjpcbiAgICAgIC8vIFNoaWZ0XG4gICAgICBnYW1lU3BlZWQgPSAyO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAyNzpcbiAgICAgIC8vIEVzY2FwZVxuICAgICAgcmVzdGFydCgpO1xuICAgICAgYnJlYWtcbiAgICBjYXNlIDM3OlxuICAgICAgLy8g0KHRgtGA0LXQu9C60LAg0LLQu9C10LLQvlxuICAgICAgaWYgKHNuYWtlLmR4ID09PSAwKSB7XG4gICAgICAgIHNuYWtlLmR4ID0gLWdyaWQ7XG4gICAgICAgIHNuYWtlLmR5ID0gMDtcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgMzg6XG4gICAgICAvLyDQodGC0YDQtdC70LrQsCDQstCy0LXRgNGFXG4gICAgICBpZiAoc25ha2UuZHkgPT09IDApIHtcbiAgICAgICAgc25ha2UuZHkgPSAtZ3JpZDtcbiAgICAgICAgc25ha2UuZHggPSAwO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgY2FzZSAzOTpcbiAgICAgIC8vINCh0YLRgNC10LvQutCwINCy0L/RgNCw0LLQvlxuICAgICAgaWYgKHNuYWtlLmR4ID09PSAwKSB7XG4gICAgICAgIHNuYWtlLmR4ID0gZ3JpZDtcbiAgICAgICAgc25ha2UuZHkgPSAwO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgY2FzZSA0MDpcbiAgICAgIC8vINCh0YLRgNC10LvQutCwINCy0L3QuNC3XG4gICAgICBpZiAoc25ha2UuZHkgPT09IDApIHtcbiAgICAgICAgc25ha2UuZHkgPSBncmlkO1xuICAgICAgICBzbmFrZS5keCA9IDA7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgfVxufSk7XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgKGUpID0+IHtcbiAgaWYoZS53aGljaCA9PT0gMTYpIHtcbiAgICBnYW1lU3BlZWQgPSA0O1xuICB9XG59KTtcblxubW9kZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgdG9nZ2xlQm9yZGVycygpO1xufSk7XG5cbnJlcXVlc3RBbmltYXRpb25GcmFtZShsb29wKTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==