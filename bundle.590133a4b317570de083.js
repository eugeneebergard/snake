(()=>{"use strict";const e=document.getElementById("game"),t=e.getContext("2d"),n=document.getElementById("counter"),d=document.getElementById("best-score"),o=document.getElementById("mode"),c=document.getElementById("borders"),l=16;let s=0,r=4,y=0,a=0,i=!1;const x={x:160,y:160,dx:l,dy:0,cells:[],maxCells:4},f={x:320,y:320};function m(e,t){return Math.floor(Math.random()*(t-e))+e}function u(){f.x=m(0,25)*l,f.y=m(0,25)*l}function h(){var e;a<y&&(e=y,d.textContent=String(e),a=e),x.x=160,x.y=160,x.cells=[],x.maxCells=4,x.dx=l,x.dy=0,y=0,n.textContent=y.toString(),u()}function g(t,n,d){c.textContent=t,e.classList.add(n),e.classList.remove(d)}function b(){i=!i,i?g("on","borders_on","borders_off"):g("off","borders_off","borders_on"),h()}document.addEventListener("keydown",(e=>{switch(e.code){case"ShiftLeft":r=2;break;case"Escape":h();break;case"ArrowLeft":case"KeyA":0===x.dx&&(x.dx=-l,x.dy=0);break;case"ArrowUp":case"KeyW":0===x.dy&&(x.dy=-l,x.dx=0);break;case"ArrowRight":case"KeyD":0===x.dx&&(x.dx=l,x.dy=0);break;case"ArrowDown":case"KeyS":0===x.dy&&(x.dy=l,x.dx=0);break;case"KeyT":b()}})),document.addEventListener("keyup",(e=>{"ShiftLeft"===e.code&&(r=4)})),o.addEventListener("click",(()=>{b()})),requestAnimationFrame((function d(){requestAnimationFrame(d),++s<r||(s=0,t.clearRect(0,0,e.width,e.height),x.x+=x.dx,x.y+=x.dy,x.x<0?i?h():x.x=e.width-l:x.x>=e.width&&(i?h():x.x=0),x.y<0?i?h():x.y=e.height-l:x.y>=e.height&&(i?h():x.y=0),x.cells.unshift({x:x.x,y:x.y}),x.cells.length>x.maxCells&&x.cells.pop(),t.fillStyle="red",t.fillRect(f.x,f.y,l-1,l-1),t.fillStyle="green",x.cells.forEach(((e,d)=>{t.fillRect(e.x,e.y,l-1,l-1),e.x===f.x&&e.y===f.y&&(x.maxCells++,u(),y++,n.textContent=y.toString());for(let t=d+1;t<x.cells.length;t++)e.x===x.cells[t].x&&e.y===x.cells[t].y&&h()})))}))})();